{% extends "layouts/base.html" %}

{% block tittle %}Home{% endblock  %}

{% block content %}

{% include "fragments/agregar.html" %}

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Agregar evento clic al bot√≥n "cerrar"
      document.getElementById("toggleBtnGasto").addEventListener("click", function() {
          let agregarFragment = document.getElementById("agregarFragment");
          if (agregarFragment.style.display === "none") {
              agregarFragment.style.display = "flex";
          } else {
              agregarFragment.style.display = "none";
          }
      });

      document.getElementById("categoria").addEventListener("change", function() {
        // Se obtiene el valor seleccionado del elemento "categoria" y se convierte a min√∫sculas
        let categoriaSeleccionada = this.value.toLowerCase();

        // Se seleccionan todas las filas dentro de un elemento <tbody> en el documento HTML
        let filas = document.querySelectorAll("tbody tr");
        
        // Se itera sobre cada fila
        filas.forEach(function(fila) {
          // Se obtiene el contenido de texto del quinto <td> (celda) en la fila y se convierte a min√∫sculas, en este caso Categoria
          let categoriaFila = fila.querySelector("td:nth-child(5)").textContent.toLowerCase();;
          // Se compara la categor√≠a seleccionada con la categor√≠a de la fila actual
            if (categoriaSeleccionada === "" || categoriaSeleccionada === categoriaFila) {
                fila.style.display = "table-row"; //Si coinciden o no se ha seleccionado ninguna categor√≠a, se muestra la fila
            } else {
                fila.style.display = "none"; // Si no coinciden, se oculta la fila
            }
        });
    });
  });

</script>

<div class="contenedor_padre">
    <div class="nav">
        <h1>PersonalMoney</h1>
        {% comment %} <div class="cuenta">
            <img src="icono" alt="">
            <div class="correo">
                <h3>Santiago Madrid</h3>
                <p>Santiagomadrid202...</p>
            </div>
        </div>         {% endcomment %}
    </div>

    <div class="nav_gastos">
        <div class="part1">
            <select name="categoria" id="categoria">
              <option value="">Todas las categor√≠as</option>
              <option value="comida">üçî Comida</option>
              <option value="transporte">üöó Transporte</option>
              <option value="pasatiempo">üé≠ Pasatiempo</option>
              <option value="casa">üè† Casa</option>
            </select>
        </div>
        <div class="part2">
            <button id="toggleBtnGasto">A√±adir gasto</button>
        </div>
    </div>

    <div class="total">
      <h3>Total registros: {{contador}}</h3>
      <p>Total: {{total}}</p>
  </div>
    <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Valor</th>
            <th>Nombre del Gasto</th>
            <th>Descripci√≥n</th>
            <th>Categor√≠a</th>
            <th>Actualizar</th>
            <th>Eliminar</th>
          </tr>
        </thead>
        <tbody>
          {% for results in registros %}
            <tr>
                    <td>{{ results.fecha}}</td>
                    <td>{{ results.valor}}</td>
                    <td>{{ results.nombre}}</td>
                    <td>{{ results.descripcion}}</td>
                    <td>{{ results.categoria}}</td>

                  <td>
                    <form action="{% url 'actualizar_gasto' results.id %}" method="get">
                        <button type="submit" class="btn_api">Actualizar</button>
                    </form>
                  </td>

                <form action="{% url 'delete' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" value={{results.id}} name = "id">
                  <td><input type="submit" class="btn_api" id="eli" value="Eliminar" ></td>
                </form>
            </tr>
          {% endfor %}
        </tbody>
      </table>
</div>
{% endblock  %}